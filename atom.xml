<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[杂七杂八记一下]]></title>
  <link href="http://lixxu.me/atom.xml" rel="self"/>
  <link href="http://lixxu.me/"/>
  <updated>2014-07-29T21:21:09+08:00</updated>
  <id>http://lixxu.me/</id>
  <author>
    <name><![CDATA[Lix Xu]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[富有的一天]]></title>
    <link href="http://lixxu.me/blog/2014/07/29/a-wealthy-day/"/>
    <updated>2014-07-29T20:27:58+08:00</updated>
    <id>http://lixxu.me/blog/2014/07/29/a-wealthy-day</id>
    <content type="html"><![CDATA[<p>从昨天发现刚到手的键盘包有一处漏缝的地方开始, 就开始连连地变得富有起来:</p>

<p>1. 键盘包提手颠倒</p>

<p>2. 今早自行车不见</p>

<p>3. 打车走错路</p>

<p>4. 刚到手没多久的翻新鼠标全新版降到历史价, 还是良心的美亚, 现在的鼠标不光是翻新货, 左键也有了问题, 迟早是个得换微动的料</p>

<p>怎么样, 是不是很富有的一天?</p>

<p>不过, 今天还是有点收获的:</p>

<!--more-->


<p>越来越觉得 <code>SourceTree</code> 启动慢, 我都尽量在命令行下使用 <code>git</code> 了 (这样才是正道吧).
每次的推送都要输入用户名和密码, 用了 <code>_netrc</code> 大法也不管用, 隐约记得之前可以的, 是人品越来越好了吗?</p>

<p>总感觉不甘心, 就翻看 <a href="http://stackoverflow.com/questions/6031214/git-how-to-use-netrc-file-on-windows-to-save-user-and-password,">http://stackoverflow.com/questions/6031214/git-how-to-use-netrc-file-on-windows-to-save-user-and-password,</a> 看到 <code>git-credential-winstore</code> 这里, 就进去看看, 下载安装, 很小巧的东西, 才十几K.</p>

<p>接着再推送时, 弹出对话框, 输入用户名和密码, 就可以了. 看这个窗口的架势, 是在系统的密码管理里面, 进去一看, 果不其然, 在通用安全里, 静静地躺着刚刚保存的密码.
没有安装 <code>git-credential-winstore</code> 的同学可以手动添加试试, 猜测此法应该仅限于 <code>http</code> 方式的验证.</p>

<p><img src="http://lixxu.qiniudn.com/windows_git_save_password.png"></p>

<p>顺便换上了 <code>度娘</code> 的CDN, 还用上了雅黑字体:
<code><script src="http://libs.baidu.com/jquery/1.9.1/jquery.min.js"></script></code></p>

<p>还有 <code>渣浪</code> 和 <code>小斗士</code> 的:</p>

<p><code><script src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script></code></p>

<p><code><script src="http://libs.useso.com/js/jquery/1.9.1/jquery.min.js"></script>
</code></p>

<!--more-->

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用七牛作为博客静态文件存放地]]></title>
    <link href="http://lixxu.me/blog/2014/07/28/use-qiniu-as-static-server/"/>
    <updated>2014-07-28T22:53:29+08:00</updated>
    <id>http://lixxu.me/blog/2014/07/28/use-qiniu-as-static-server</id>
    <content type="html"><![CDATA[<p>之前的图片放在 <code>images</code> 目录下, 不过随着博客的文章会越来越多, 将导致整个库变得越来越大, 而这些静态文件是没必要放在库里的.</p>

<p>碰巧在网上看到一篇提问说&#8221; 博客的静态文件都放在哪里托管? &ldquo;, 回答有各种, 也有 <code>七牛</code>, 而我对七牛算是有点了解, 知道这是一家使用 <code>go</code> 语言作为后台的云存储公司. 又在上海GDG组织的一次活动上听过创始人许式伟的演讲, 所以对七牛比较熟悉, 并且每月有10G的免费流量可以用, 个人用的话应该足够了, 就决定使用七牛放放静态文件.</p>

<p>好了, 不废话了.</p>

<p>1. 首先到官网注册账号 (推荐绑定手机号, 可以有更多的免费资源可用): <a href="https://portal.qiniu.com/signup">https://portal.qiniu.com/signup</a></p>

<!--more-->


<p><img src="http://lixxu.qiniudn.com/qiniu_signup.png"></p>

<p>2. 创建存储空间, 博客用的话就创建一个公开空间</p>

<p><img src="http://lixxu.qiniudn.com/qiniu_add_space.png"></p>

<p>3. 简单设置一下</p>

<p><img src="http://lixxu.qiniudn.com/qiniu_basic_setting.png"></p>

<p><img src="http://lixxu.qiniudn.com/qiniu_advanced_setting.png"></p>

<p>4. 把密钥记录下来, 待会的上传脚本需要用到</p>

<p><img src="http://lixxu.qiniudn.com/qiniu_key.png"></p>

<p>5. 到这里下载客户端工具 (<a href="http://developer.qiniu.com/docs/v6/tools/qrsync.html">http://developer.qiniu.com/docs/v6/tools/qrsync.html</a>), 有命令行和图形两种, 参照右面的说明就可以了.</p>

<p>需要注意的是配置文件里 <code>dest</code> 的部分不要像文档里的那样分行显得好看, 全部合并到一行里, 否则会出错. 把红框里的换成你自己的目录, 密钥和空间名.</p>

<p>更多详情可以参考官方文档, 比如本地文件上传后就可以删除了, 如果需要同步删除的应该怎么做等</p>

<p><img src="http://lixxu.qiniudn.com/qiniu_rsync_config.png"></p>

<p>6. 创建一个批处理文件, 方便上传, 如 <code>qiniu_pub.bat</code></p>

<p><img src="http://lixxu.qiniudn.com/qiniu_rsync_bat.png"></p>

<p>7. 以后有需要上传的文件, 就丢到你定义好的 <code>public</code> 文件夹里, 再运行 <code>qiniu_pub.bat</code> 就可以了, 已经同步的文件如果没有修改就不会同步的</p>

<p><img src="http://lixxu.qiniudn.com/qiniu_upload.png"></p>

<p>附我的七牛上传的目录结构, 仅供参考:</p>

<p><img src="http://lixxu.qiniudn.com/qiniu_folders.png"></p>

<p>好了, 码完收工, 早睡早起.</p>

<!--more-->

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[抓取 <<码农故事>> 文本]]></title>
    <link href="http://lixxu.me/blog/2014/07/25/get-coder-story-text-from-web/"/>
    <updated>2014-07-25T08:46:39+08:00</updated>
    <id>http://lixxu.me/blog/2014/07/25/get-coder-story-text-from-web</id>
    <content type="html"><![CDATA[<p>偶然看到这样一篇关于码农的小说, 感觉还可以, 就想收集下来慢慢看.
但是都是网页而且还挺多, 就看看有没有整理好的全本, 搜了一下没找到.</p>

<p>接着就手动复制粘贴, 贴了几篇感觉太枯燥, 就琢磨着如何使用 <code>requests</code> 和 <code>BeautifulSoup</code> 来提取文本.</p>

<p>很少使用 <code>BeautifulSoup</code>, 所以临时去看了一下文档, 开始走起.</p>

<p>1. 先用浏览器的 <code>审查元素</code> 获取分页的页面结构, 这里我们只需要 <code>标题</code> 和 <code>链接地址</code> 即可</p>

<p><img src="http://lixxu.qiniudn.com/coder_page.png"></p>

<!--more-->


<p>2. 分析页面内容抓取 <code>标题</code> 和 <code>链接地址</code>, 还一并抓取当前的章节, 否则就没法知道顺序了</p>

<p>3. 根据获取的链接抓取全文</p>

<p>4. 分析全文, 在 <code>entry</code> 下面的 <code>p</code> 和 <code>span</code> 里, 一开始我以为都在 <code>p</code> 结构里, 结果最后发现有的章节是空的, 看了下空的章节的结构, 原来用的是 <code>&lt;div&gt;&lt;span&gt;...&lt;/span&gt;&lt;/div&gt;</code> 的结构</p>

<p><img src="http://lixxu.qiniudn.com/coder_post.png"></p>

<p><img src="http://lixxu.qiniudn.com/coder_post2.png"></p>

<p>5. 这些都确定了后就可以开工了, 当然我是逐步确定的. 我的流程是: 按章节写到单独的文件里, 最后再合并. 好了, <code>Talk is cheap, show me the code.</code>:</p>

<figure class='code'><figcaption><span>coder_story.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c">#-*- coding: utf-8 -*-</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os.path</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">requests</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">re</span>
</span><span class='line'>
</span><span class='line'><span class="n">digit_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;(\d+-?\d*)&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">url</span> <span class="o">=</span> <span class="s">r&#39;http://blog.jobbole.com/tag/</span><span class="si">%E</span><span class="s">7%A0</span><span class="si">%81%</span><span class="s">E5</span><span class="si">%86%</span><span class="s">9C</span><span class="si">%E</span><span class="s">6</span><span class="si">%95%</span><span class="s">85</span><span class="si">%E</span><span class="s">4%BA%8B/page/{}/&#39;</span>
</span><span class='line'><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;coder_story&#39;</span><span class="p">):</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s">&#39;coder_story&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">&#39;coder_story&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
</span><span class='line'>    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page</span><span class="p">))</span>
</span><span class='line'>    <span class="c"># soup = BeautifulSoup(r.content)  # lxml未安装时用这行</span>
</span><span class='line'>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s">&#39;lxml&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">meta_title</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&#39;meta-title&#39;</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># 我们要的都必须有title</span>
</span><span class='line'>        <span class="k">if</span> <span class="s">&#39;title&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">meta_title</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
</span><span class='line'>            <span class="k">continue</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># 不是这个小说不要</span>
</span><span class='line'>        <span class="k">if</span> <span class="s">u&#39;老码农原创小说&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">meta_title</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]:</span>
</span><span class='line'>            <span class="k">continue</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="n">meta_title</span><span class="p">)</span>  <span class="c"># 打印一下标题</span>
</span><span class='line'>        <span class="n">href</span> <span class="o">=</span> <span class="n">meta_title</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">)</span>  <span class="c"># 获取文章链接</span>
</span><span class='line'>        <span class="c"># 获取章节序号</span>
</span><span class='line'>        <span class="n">found</span> <span class="o">=</span> <span class="n">digit_re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">meta_title</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">])</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
</span><span class='line'>            <span class="k">continue</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># 个位数章节前补0, 为了后面的合并</span>
</span><span class='line'>        <span class="n">page_no</span> <span class="o">=</span> <span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">page_no</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span class='line'>            <span class="n">page_no</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span> <span class="o">+</span> <span class="n">page_no</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># 获取文章的内容</span>
</span><span class='line'>        <span class="n">r2</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>
</span><span class='line'>        <span class="c"># s2 = BeautifulSoup(r2.content)  # lxml未安装时用这行</span>
</span><span class='line'>        <span class="n">s2</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s">&#39;lxml&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">entry</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&#39;entry&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;{}.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page_no</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>            <span class="c"># 内容在 &lt;p&gt;...&lt;/p&gt; 或 &lt;div&gt;&lt;span&gt;...&lt;/span&gt;&lt;/div&gt;里</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">find_all</span><span class="p">([</span><span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="s">&#39;span&#39;</span><span class="p">]):</span>
</span><span class='line'>                <span class="c"># copyright-meta部分, 跳过</span>
</span><span class='line'>                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;class&#39;</span><span class="p">):</span>
</span><span class='line'>                    <span class="k">continue</span>
</span><span class='line'>
</span><span class='line'>                <span class="c"># 空白行, 文件里写两行空白, 便于阅读</span>
</span><span class='line'>                <span class="n">text</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
</span><span class='line'>                <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n\r\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class='line'>                    <span class="k">continue</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class='line'>                <span class="c"># &quot;待续&quot; 的地方, 接着就是另一章了, 插入空行</span>
</span><span class='line'>                <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">u&#39;&lt;</span><span class="se">\u5f85\u7eed</span><span class="s">&gt;&#39;</span><span class="p">):</span>
</span><span class='line'>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>6. 合并到一个文件, 用 <code>Python</code> 碰到编码错误, 时间紧, 就用批处理好了, 还简单</p>

<figure class='code'><figcaption><span>coder_story.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">copy</span> <span class="o">*.</span><span class="n">txt</span> <span class="err">码农故事</span><span class="o">.</span><span class="n">txt</span>
</span></code></pre></td></tr></table></div></figure>


<p>7. 打完收工.</p>

<p>后记:</p>

<p>就在合并时, 看到最后的一句话, 马上吐出一升老血:</p>

<p><img src="http://lixxu.qiniudn.com/coder_end.png"></p>

<p><img src="http://lixxu.qiniudn.com/tuxie.gif"></p>

<p>不过, 在 <code>kindle</code> 上还是 txt 的效果好一些, pdf 转换的有些乱码, 不完美.</p>

<p><img src="http://lixxu.qiniudn.com/kindle_bug.png"></p>

<p>附下载地址:</p>

<p>1. TXT <a href="http://lixxu.qiniudn.com/%E7%A0%81%E5%86%9C%E6%95%85%E4%BA%8B.txt">http://lixxu.qiniudn.com/%E7%A0%81%E5%86%9C%E6%95%85%E4%BA%8B.txt</a></p>

<p>2. PDF <a href="http://lixxu.qiniudn.com/%E7%A0%81%E5%86%9C%E6%95%85%E4%BA%8B.pdf">http://lixxu.qiniudn.com/%E7%A0%81%E5%86%9C%E6%95%85%E4%BA%8B.pdf</a></p>

<!--more-->

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android刷机相关]]></title>
    <link href="http://lixxu.me/blog/2014/07/01/android-flash-stuff/"/>
    <updated>2014-07-01T18:31:16+08:00</updated>
    <id>http://lixxu.me/blog/2014/07/01/android-flash-stuff</id>
    <content type="html"><![CDATA[<p>记录下来备忘:</p>

<p>背景:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. Nexus 4
</span><span class='line'>
</span><span class='line'>2. Mokee 4.4.4
</span><span class='line'>
</span><span class='line'>3. TWRP</span></code></pre></td></tr></table></div></figure>


<p>我保存的基带共享链接: <a href="http://pan.baidu.com/s/1gdf4pfd">http://pan.baidu.com/s/1gdf4pfd</a></p>

<p>原帖看这里: <a href="http://bbs.mfunz.com/thread-947343-1-1.html">http://bbs.mfunz.com/thread-947343-1-1.html</a></p>

<p>1. 刷基带, 按照帖子来就可以, 简单就是</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. 进入fastboot
</span><span class='line'>2. flash-all.bat</span></code></pre></td></tr></table></div></figure>


<p>2. 更新TWRP <a href="http://teamw.in/project/twrp2/129">http://teamw.in/project/twrp2/129</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Download - Recovery Image Method:
</span><span class='line'>
</span><span class='line'>Download the newest .img file here
</span><span class='line'>
</span><span class='line'>Download the above file.  Turn off your device. Turn on the device and keep
</span><span class='line'>holding volume down until a menu shows up. The device will now be in fastboot
</span><span class='line'>mode. Plug the device into your computer.  If you have the right drivers
</span><span class='line'>installed, your screen should now say FASTBOOT USB.  Run the following command
</span><span class='line'>via the command line:
</span><span class='line'>
</span><span class='line'>fastboot flash recovery recoveryfilename.img
</span><span class='line'>
</span><span class='line'>Note that you will need to change the last part to match the name of the file
</span><span class='line'>that you just downloaded.  You will also need adb and fastboot for your computer.</span></code></pre></td></tr></table></div></figure>


<p>简单讲就是:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. 下载.img文件
</span><span class='line'>2. 进入fastboot
</span><span class='line'>3. 运行 fastboot flash recovery openrecovery-twrp-2.7.1.0-mako.img
</span><span class='line'>
</span><span class='line'>注意:
</span><span class='line'>1. 这里的 openrecovery-twrp-2.7.1.0-mako.img 要换成你对应的名字
</span><span class='line'>2. fastboot 实际是 fastboot.exe</span></code></pre></td></tr></table></div></figure>


<p>补: 如何进 <code>fastboot</code>?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. 关机
</span><span class='line'>2. 电源 + 音量-, 直到出现菜单</span></code></pre></td></tr></table></div></figure>


<p>以上.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用 Python 设置系统时间]]></title>
    <link href="http://lixxu.me/blog/2014/06/22/use-python-set-system-time/"/>
    <updated>2014-06-22T16:53:43+08:00</updated>
    <id>http://lixxu.me/blog/2014/06/22/use-python-set-system-time</id>
    <content type="html"><![CDATA[<p>接上文: <a href="http://lixxu.me/blog/2014/06/22/nssm-install-windows-service">使用 NSSM 安装 Windows 系统服务</a></p>

<p>上一篇介绍使用了 <code>net time</code> 来同步系统时间, 后来突然想到如果没有服务器可供同步时间或电脑无法直接连接到服务器怎么办?</p>

<p>就去找了下使用 <code>Python</code> 设置时间的例子, 还真有: <a href="http://stackoverflow.com/questions/12081310/python-module-to-change-system-date-and-time">http://stackoverflow.com/questions/12081310/python-module-to-change-system-date-and-time</a></p>

<p>直接贴在这里:</p>

<figure class='code'><figcaption><span>set_time.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">datetime</span>
</span><span class='line'>
</span><span class='line'><span class="n">time_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="c"># Year</span>
</span><span class='line'>                 <span class="mi">9</span><span class="p">,</span> <span class="c"># Month</span>
</span><span class='line'>                 <span class="mi">6</span><span class="p">,</span> <span class="c"># Day</span>
</span><span class='line'>                 <span class="mi">0</span><span class="p">,</span> <span class="c"># Hour</span>
</span><span class='line'>                <span class="mi">38</span><span class="p">,</span> <span class="c"># Minute</span>
</span><span class='line'>                 <span class="mi">0</span><span class="p">,</span> <span class="c"># Second</span>
</span><span class='line'>                 <span class="mi">0</span><span class="p">,</span> <span class="c"># Millisecond</span>
</span><span class='line'>              <span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">_win_set_time</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">):</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">pywin32</span>
</span><span class='line'>    <span class="c"># http://timgolden.me.uk/pywin32-docs/win32api__SetSystemTime_meth.html</span>
</span><span class='line'>    <span class="c"># pywin32.SetSystemTime(year, month, dayOfWeek, day, hour, minute, second, millseconds)</span>
</span><span class='line'>    <span class="n">dayOfWeek</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">)</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
</span><span class='line'>    <span class="n">pywin32</span><span class="o">.</span><span class="n">SetSystemTime</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">dayOfWeek</span><span class="p">,)</span> <span class="o">+</span> <span class="n">time_tuple</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">_linux_set_time</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">):</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">ctypes</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">ctypes.util</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># /usr/include/linux/time.h:</span>
</span><span class='line'>    <span class="c">#</span>
</span><span class='line'>    <span class="c"># define CLOCK_REALTIME                     0</span>
</span><span class='line'>    <span class="n">CLOCK_REALTIME</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># /usr/include/time.h</span>
</span><span class='line'>    <span class="c">#</span>
</span><span class='line'>    <span class="c"># struct timespec</span>
</span><span class='line'>    <span class="c">#  {</span>
</span><span class='line'>    <span class="c">#    __time_t tv_sec;            /* Seconds.  */</span>
</span><span class='line'>    <span class="c">#    long int tv_nsec;           /* Nanoseconds.  */</span>
</span><span class='line'>    <span class="c">#  };</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">timespec</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
</span><span class='line'>        <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;tv_sec&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">),</span>
</span><span class='line'>                    <span class="p">(</span><span class="s">&quot;tv_nsec&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">)]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">librt</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_library</span><span class="p">(</span><span class="s">&quot;rt&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ts</span> <span class="o">=</span> <span class="n">timespec</span><span class="p">()</span>
</span><span class='line'>    <span class="n">ts</span><span class="o">.</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">time_tuple</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()))</span>
</span><span class='line'>    <span class="n">ts</span><span class="o">.</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="n">time_tuple</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000000</span> <span class="c"># Millisecond to nanosecond</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># http://linux.die.net/man/3/clock_settime</span>
</span><span class='line'>    <span class="n">librt</span><span class="o">.</span><span class="n">clock_settime</span><span class="p">(</span><span class="n">CLOCK_REALTIME</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">ts</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s">&#39;linux2&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">_linux_set_time</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">elif</span>  <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s">&#39;win32&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">_win_set_time</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<p>可是没有可供同步用的服务器, 那时间怎么来呢?</p>

<p>1. 跑一个 web, 可以返回一个 <code>json</code> 的数据, 如:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c">#-*- coding: utf-8 -*-</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
</span><span class='line'>
</span><span class='line'><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/api/get-time/&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_time</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()))</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>客户端可以这样来获取和同步时间 (假设是 Windows 平台), 上面的 <code>set_time.py</code> 需要改一下:</p>

<figure class='code'><figcaption><span>set_time2.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">datetime</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">_win_set_time</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&#39;&#39;&#39;time_tuple: </span>
</span><span class='line'><span class="sd">    year, month, day, hour, minute, second, day_of_week, day_of_year, is_dist</span>
</span><span class='line'><span class="sd">    &#39;&#39;&#39;</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">pywin32</span>
</span><span class='line'>    <span class="c"># http://timgolden.me.uk/pywin32-docs/win32api__SetSystemTime_meth.html</span>
</span><span class='line'>    <span class="c"># pywin32.SetSystemTime(year, month, dayOfWeek, day, hour, minute, second, millseconds)</span>
</span><span class='line'>    <span class="n">tt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">)</span>
</span><span class='line'>    <span class="n">tt</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">tt</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="c"># add day_of_week </span>
</span><span class='line'>    <span class="n">tt</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c"># set miliseconds</span>
</span><span class='line'>    <span class="n">pywin32</span><span class="o">.</span><span class="n">SetSystemTime</span><span class="p">(</span><span class="o">*</span><span class="n">tt</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">_linux_set_time</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">):</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">ctypes</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">ctypes.util</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># /usr/include/linux/time.h:</span>
</span><span class='line'>    <span class="c">#</span>
</span><span class='line'>    <span class="c"># define CLOCK_REALTIME                     0</span>
</span><span class='line'>    <span class="n">CLOCK_REALTIME</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># /usr/include/time.h</span>
</span><span class='line'>    <span class="c">#</span>
</span><span class='line'>    <span class="c"># struct timespec</span>
</span><span class='line'>    <span class="c">#  {</span>
</span><span class='line'>    <span class="c">#    __time_t tv_sec;            /* Seconds.  */</span>
</span><span class='line'>    <span class="c">#    long int tv_nsec;           /* Nanoseconds.  */</span>
</span><span class='line'>    <span class="c">#  };</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">timespec</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
</span><span class='line'>        <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;tv_sec&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">),</span>
</span><span class='line'>                    <span class="p">(</span><span class="s">&quot;tv_nsec&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">)]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">librt</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_library</span><span class="p">(</span><span class="s">&quot;rt&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ts</span> <span class="o">=</span> <span class="n">timespec</span><span class="p">()</span>
</span><span class='line'>    <span class="n">ts</span><span class="o">.</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">time_tuple</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()))</span>
</span><span class='line'>    <span class="n">ts</span><span class="o">.</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="n">time_tuple</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000000</span> <span class="c"># Millisecond to nanosecond</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># http://linux.die.net/man/3/clock_settime</span>
</span><span class='line'>    <span class="n">librt</span><span class="o">.</span><span class="n">clock_settime</span><span class="p">(</span><span class="n">CLOCK_REALTIME</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">ts</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">set_time</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s">&#39;linux2&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="n">_linux_set_time</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">elif</span>  <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s">&#39;win32&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="n">_win_set_time</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>sync_time.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c">#-*- coding: utf-8 -*-</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">requests</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">set_time2</span>
</span><span class='line'>
</span><span class='line'><span class="n">URL</span> <span class="o">=</span> <span class="s">&#39;http://a.b.c.d:5000/api/get-time/&#39;</span>
</span><span class='line'><span class="n">offset</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">timezone</span> <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span><span class="o">.</span><span class="n">tm_isdst</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="n">time</span><span class="o">.</span><span class="n">altzone</span>
</span><span class='line'><span class="n">LOCAL_TZ</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_time</span><span class="p">():</span>
</span><span class='line'>    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
</span><span class='line'>    <span class="n">json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">json</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">sync_time</span><span class="p">(</span><span class="n">tz</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
</span><span class='line'>    <span class="n">ts</span> <span class="o">=</span> <span class="n">get_time</span><span class="p">()</span>
</span><span class='line'>    <span class="n">to_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">ts</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">LOCAL_TZ</span><span class="p">)</span>
</span><span class='line'>    <span class="n">set_time2</span><span class="o">.</span><span class="n">set_time</span><span class="p">(</span><span class="n">to_time</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">sync_time</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>注意: 以上代码未经测试, 可能有错误.</p>

<p>2. 如果无法直接连接到提供时间的服务器呢?
比如有两个网络, 一个是测试电脑的内部网, 服务器在测试的通用网络.</p>

<p>可以使用一个可以连通两个网络的电脑上作为交换数据的中间人, 具体的是使用文件交换还是像 <code>socket</code> 之类的网络接口服务交换就随你的喜好了.</p>

<p>拙见.</p>

<!--more-->

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用 NSSM 安装 Windows 系统服务]]></title>
    <link href="http://lixxu.me/blog/2014/06/22/nssm-install-windows-service/"/>
    <updated>2014-06-22T16:15:55+08:00</updated>
    <id>http://lixxu.me/blog/2014/06/22/nssm-install-windows-service</id>
    <content type="html"><![CDATA[<p>工厂里的某些测试电脑存在时间不对的问题, 最开始使用简单的批处理加上
<a href="http://nssm.cc/">nssm</a> 安装成 service 的方式, 比如下面的示例:</p>

<figure class='code'><figcaption><span>sync_time.bat </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'>sync_time:
</span><span class='line'>net time \\a.b.c.d <span class="n">/set</span> <span class="n">/y</span>
</span><span class='line'>
</span><span class='line'>sleep <span class="m">3600</span>
</span><span class='line'><span class="k">goto</span> <span class="nl">sync_time</span>
</span></code></pre></td></tr></table></div></figure>


<p>但在使用的过程中出现了这个 service 吃掉许多 CPU 的问题.
按道理说在 sleep 后应该会进入休眠状态, 不应该再占用 CPU.
不清楚什么原因, 就使用 <code>Python</code> 重写了.</p>

<!--more-->


<p>1. 主程序 <code>main.py</code></p>

<figure class='code'><figcaption><span>main.py </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c">#-*- coding: utf-8 -*-</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">subprocess</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">click</span>
</span><span class='line'>
</span><span class='line'><span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;0.1&#39;</span>
</span><span class='line'><span class="n">DEFAULT_SERVERS</span> <span class="o">=</span> <span class="s">&#39;server_a,server_b&#39;</span>
</span><span class='line'><span class="n">IP_MAPS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">server_a</span><span class="o">=</span><span class="s">&#39;a.b.c.d&#39;</span><span class="p">,</span> <span class="n">server_b</span><span class="o">=</span><span class="s">&#39;a.b.c.e&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">CMD</span> <span class="o">=</span> <span class="s">r&#39;net time </span><span class="se">\\</span><span class="s">{} /set /y&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">run_cmd</span><span class="p">(</span><span class="n">server</span><span class="p">):</span>
</span><span class='line'>    <span class="n">status</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">CMD</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">server</span><span class="p">))</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ip</span> <span class="o">=</span> <span class="n">IP_MAPS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">ip</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">CMD</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="bp">False</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@click.command</span><span class="p">()</span>
</span><span class='line'><span class="nd">@click.option</span><span class="p">(</span><span class="s">&#39;--servers&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_SERVERS</span><span class="p">,</span>
</span><span class='line'>              <span class="n">help</span><span class="o">=</span><span class="s">&#39;servers name or IP list, seperated by &quot;,&quot;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nd">@click.option</span><span class="p">(</span><span class="s">&#39;--sleep&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
</span><span class='line'>              <span class="n">help</span><span class="o">=</span><span class="s">&#39;sleep seconds till next run, default is 600s (10 minutes)&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">sync_time</span><span class="p">(</span><span class="n">servers</span><span class="p">,</span> <span class="n">sleep</span><span class="p">):</span>
</span><span class='line'>    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">):</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">run_cmd</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
</span><span class='line'>                <span class="k">break</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">sync_time</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>2. 使用 <code>py2exe</code> 或其他工具打包 <code>main.py</code> 为可执行文件, 比如 <code>SyncTimer.exe</code></p>

<p>3. 然后是安装/删除 service 的批处理:</p>

<p>3.1 <code>install.bat</code></p>

<figure class='code'><figcaption><span>install.bat </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="p">@</span><span class="k">echo</span> <span class="k">off</span>
</span><span class='line'><span class="k">set</span> <span class="nv">service</span><span class="o">=</span>SyncTimer
</span><span class='line'><span class="k">echo</span> <span class="nv">%PROCESSOR_ARCHITECTURE%</span> <span class="p">|</span> <span class="n">find</span> <span class="n">/i</span> <span class="s2">&quot;x86&quot;</span> <span class="p">&gt;</span> <span class="n">nul</span>
</span><span class='line'><span class="k">if</span> <span class="nv">%errorlevel%</span><span class="o">==</span><span class="m">0</span> (
</span><span class='line'>    <span class="k">set</span> <span class="nv">nssm</span><span class="o">=</span>nssm<span class="m">32</span>.exe
</span><span class='line'>) <span class="k">else</span> (
</span><span class='line'>    <span class="k">set</span> <span class="nv">nssm</span><span class="o">=</span>nssm<span class="m">64</span>.exe
</span><span class='line'>)
</span><span class='line'>
</span><span class='line'><span class="nv">%nssm%</span> install <span class="s2">&quot;%service%&quot;</span> <span class="s2">&quot;%~dp0SyncTimer.exe&quot;</span>
</span><span class='line'>
</span><span class='line'>net start <span class="nv">%service%</span>
</span><span class='line'>
</span><span class='line'>sleep <span class="m">5</span>
</span></code></pre></td></tr></table></div></figure>


<p>3.2 <code>remove.bat</code></p>

<figure class='code'><figcaption><span>remove.bat </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="p">@</span><span class="k">echo</span> <span class="k">off</span>
</span><span class='line'><span class="k">set</span> <span class="nv">exename</span><span class="o">=</span>SyncTimer
</span><span class='line'>net stop <span class="nv">%exename%</span>
</span><span class='line'>
</span><span class='line'><span class="k">echo</span> <span class="nv">%PROCESSOR_ARCHITECTURE%</span> <span class="p">|</span> <span class="n">find</span> <span class="n">/i</span> <span class="s2">&quot;x86&quot;</span> <span class="p">&gt;</span> <span class="n">nul</span>
</span><span class='line'><span class="k">if</span> <span class="nv">%errorlevel%</span><span class="o">==</span><span class="m">0</span> (
</span><span class='line'>    <span class="k">set</span> <span class="nv">nssm</span><span class="o">=</span>nssm<span class="m">32</span>.exe
</span><span class='line'>) <span class="k">else</span> (
</span><span class='line'>    <span class="k">set</span> <span class="nv">nssm</span><span class="o">=</span>nssm<span class="m">64</span>.exe
</span><span class='line'>)
</span><span class='line'>
</span><span class='line'><span class="nv">%nssm%</span> remove <span class="s2">&quot;%exename%&quot;</span> confirm
</span><span class='line'>sleep <span class="m">5</span>
</span></code></pre></td></tr></table></div></figure>


<p>当然了, 你需要到 <a href="http://nssm.cc/download">http://nssm.cc/download</a> 下载 <code>nssm</code> 的执行程序.
分别把 32 位和 64 位的执行文件和你的 EXE 文件放到一起, 并改名为 <code>nssm32.exe</code> 和 <code>nssm64.exe</code>. 在安装 service 后也不能删除这些文件, 因为 service 关联的程序是 <code>nssm</code>.</p>

<p>这里有个注意的地方:
<code>nssm</code> 的文档上说使用命令行安装时如果不想弹出确认对话框, 可以写成这样的:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%nssm% install "%service%" "%~dp0SyncTimer.exe" confirm</span></code></pre></td></tr></table></div></figure>


<p>但是这样安装的 service 始终处于 <code>paused</code> 状态, 一度让我以为是程序里 <code>sleep</code> 导致的. 但在使用对话框安装时却一点问题都没有.
后来看了下系统日志, 发现是路径的问题. 后面就使用 exe 的绝对路径并且把后面的 <code>confirm</code> 给去掉了才算正常.</p>

<p>本来打算写如何使用 <code>Python</code> 设置系统时间的怎么变成 <code>nssm</code> 了?</p>

<!--more-->

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Flask-script 和 Gevent 结合使用]]></title>
    <link href="http://lixxu.me/blog/2014/06/10/use-gevent-with-flask-script/"/>
    <updated>2014-06-10T15:09:51+08:00</updated>
    <id>http://lixxu.me/blog/2014/06/10/use-gevent-with-flask-script</id>
    <content type="html"><![CDATA[<p>之前一直没用过 <code>flask-script</code>, 可是看了很多其他人的例子都在用这么个玩意. 碰巧手上有个现在做的一个应用, 所以打算用一下.</p>

<p>用了之后出现问题了: <code>python manage.py runserver</code> 使用的是默认的 <code>wsgi 服务器</code>, 而我在 windows 下一直使用 <code>gevent</code> 调试的.
看了下文档, 差不多就是这样:</p>

<figure class='code'><figcaption><span>manage.py mark:40-53 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c">#-*- coding: utf-8 -*-</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os.path</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">create_app</span><span class="p">,</span> <span class="n">db</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">app.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">flask.ext.script</span> <span class="kn">import</span> <span class="n">Manager</span><span class="p">,</span> <span class="n">Shell</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">flask.ext.migrate</span> <span class="kn">import</span> <span class="n">Migrate</span><span class="p">,</span> <span class="n">MigrateCommand</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;app.env&#39;</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># print(&#39;importing environment from app.env...&#39;)</span>
</span><span class='line'>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;app.env&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span class='line'>                <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'><span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;APP_ENV&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;default&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">manager</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span><span class='line'><span class="n">migrate</span> <span class="o">=</span> <span class="n">Migrate</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">make_shell_context</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">User</span><span class="o">=</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">manager</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="s">&#39;shell&#39;</span><span class="p">,</span> <span class="n">Shell</span><span class="p">(</span><span class="n">make_context</span><span class="o">=</span><span class="n">make_shell_context</span><span class="p">))</span>
</span><span class='line'><span class="n">manager</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="s">&#39;db&#39;</span><span class="p">,</span> <span class="n">MigrateCommand</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@manager.command</span>
</span><span class='line'><span class="k">def</span> <span class="nf">deploy</span><span class="p">():</span>
</span><span class='line'>    <span class="kn">from</span> <span class="nn">flask.ext.migrate</span> <span class="kn">import</span> <span class="n">upgrade</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">upgrade</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@manager.command</span>
</span><span class='line'><span class="k">def</span> <span class="nf">rungevent</span><span class="p">():</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">werkzeug.serving</span>
</span><span class='line'>    <span class="kn">from</span> <span class="nn">werkzeug.debug</span> <span class="kn">import</span> <span class="n">DebuggedApplication</span>
</span><span class='line'>    <span class="kn">from</span> <span class="nn">gevent.wsgi</span> <span class="kn">import</span> <span class="n">WSGIServer</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@werkzeug.serving.run_with_reloader</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
</span><span class='line'>        <span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class='line'>        <span class="n">dapp</span> <span class="o">=</span> <span class="n">DebuggedApplication</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">evalex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="n">ws</span> <span class="o">=</span> <span class="n">WSGIServer</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">),</span> <span class="n">dapp</span><span class="p">)</span>
</span><span class='line'>        <span class="n">ws</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">run</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">manager</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后使用下面的命令就可以了:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py rungevent
</span></code></pre></td></tr></table></div></figure>


<p>可是在 <code>rungevent</code> 里, 无论怎么传参数控制是否处在 <code>debug</code> 状态, 始终是 <code>autoreload</code>, 这可能是 <code>app.env</code> 里我设定了开发模式导致的.</p>

<p>不过, 算了, 生产环境我是用 <code>uwsgi</code> 的, 用不到这个玩意.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在 PyPi 上发布软件包]]></title>
    <link href="http://lixxu.me/blog/2014/06/09/how-to-register-pypi/"/>
    <updated>2014-06-09T14:33:10+08:00</updated>
    <id>http://lixxu.me/blog/2014/06/09/how-to-register-pypi</id>
    <content type="html"><![CDATA[<p>距上次发布软件包过去了很久, 都忘了操作步骤了, 今天碰巧发布一个小包, 放狗搜了一下, 记下来备忘:</p>

<p>来源: <a href="http://peterdowns.com/posts/first-time-with-pypi.html">http://peterdowns.com/posts/first-time-with-pypi.html</a></p>

<p>基本操作:</p>

<p>1. 准备好 <code>setup.py</code>, 提供一下 <code>setup.cfg</code></p>

<figure class='code'><figcaption><span>setup.cfg </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="k">[metadata]</span>
</span><span class='line'><span class="na">description-file</span> <span class="o">=</span> <span class="s">README.md</span>
</span></code></pre></td></tr></table></div></figure>


<p>2. 注册:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python setup.py register -r pypi</span></code></pre></td></tr></table></div></figure>


<p>按提示做选择就可以了:</p>

<p><img src="http://lixxu.qiniudn.com/pypi.png"></p>

<p>3. 上传, 一串字符滚过之后看到 <code>200</code> 就 OK 了</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python setup.py upload -r pypi</span></code></pre></td></tr></table></div></figure>


<p><img src="http://lixxu.qiniudn.com/pypi_upload.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[从输入 URL 到页面加载完成的过程中都发生了什么事情?]]></title>
    <link href="http://lixxu.me/blog/2014/05/26/what-happened-after-enter-url/"/>
    <updated>2014-05-26T16:25:28+08:00</updated>
    <id>http://lixxu.me/blog/2014/05/26/what-happened-after-enter-url</id>
    <content type="html"><![CDATA[<p><img src="http://lixxu.qiniudn.com/nwind-weibo.png"></p>

<p>原文很长, 没看完我就觉得什么也不懂了, 囧.</p>

<p><a href="http://fex.baidu.com/blog/2014/05/what-happen/">http://fex.baidu.com/blog/2014/05/what-happen/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[程序员版<<泡沫>>]]></title>
    <link href="http://lixxu.me/blog/2014/05/19/coder-bubbles/"/>
    <updated>2014-05-19T13:25:19+08:00</updated>
    <id>http://lixxu.me/blog/2014/05/19/coder-bubbles</id>
    <content type="html"><![CDATA[<p>程序员版&lt;&lt;泡沫>> <a href="http://www.v2ex.com/t/113021#reply17">http://www.v2ex.com/t/113021#reply17</a></p>

<p><code>派森大法</code>, <code>烫烫烫烫烫烫烫烫烫烫烫烫烫烫</code>, &hellip;</p>

<p>视频在此, 加上弹幕才欢乐:</p>

<p><a href="http://www.acfun.com/v/ac1171084">http://www.acfun.com/v/ac1171084</a></p>

<object type="application/x-shockwave-flash" data="http://static.acfun.com/player/ACFlashPlayer.out.swf" width="550" height="348"><param name="allowfullscreen" value="true"><param name="allowscriptaccess" value="always"><param name="seamlesstabbing" value="true"><param name="wmode" value="direct"><param name="allowFullscreenInteractive" value="true"><param name="flashvars" value="type=page&url=http://www.acfun.com/v/ac1171084"></object>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pyodbc in 查询]]></title>
    <link href="http://lixxu.me/blog/2014/05/12/sql-in-operator-in-pyodbc/"/>
    <updated>2014-05-12T11:37:58+08:00</updated>
    <id>http://lixxu.me/blog/2014/05/12/sql-in-operator-in-pyodbc</id>
    <content type="html"><![CDATA[<p>参考链接, 看 <code>geographika</code> 的答案即可:</p>

<p><a href="http://stackoverflow.com/questions/4819356/sql-in-operator-using-pyodbc-and-sql-server">http://stackoverflow.com/questions/4819356/sql-in-operator-using-pyodbc-and-sql-server</a></p>

<p>记录一下如何在 <code>pyodbc</code> 中使用 <code>in</code> 查询:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">pyodbc</span>
</span><span class='line'>
</span><span class='line'><span class="n">alist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span class='line'><span class="n">sql</span> <span class="o">=</span> <span class="s">&#39;select * from table where field1 in (</span><span class="si">%s</span><span class="s">)&#39;</span>
</span><span class='line'><span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span class='line'><span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class='line'><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;?&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">alist</span><span class="p">))),</span> <span class="n">alist</span><span class="p">)</span>
</span><span class='line'><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HHKB PRO2]]></title>
    <link href="http://lixxu.me/blog/2014/05/12/hhkb-pro2/"/>
    <updated>2014-05-12T09:19:52+08:00</updated>
    <id>http://lixxu.me/blog/2014/05/12/hhkb-pro2</id>
    <content type="html"><![CDATA[<p>我中毒了:</p>

<p><a href="http://knewone.com/things/hhkb-pro-2/reviews/536c3b0731302d3b70ed0000">http://knewone.com/things/hhkb-pro-2/reviews/536c3b0731302d3b70ed0000</a>
<a href="http://ju.outofmemory.cn/entry/28653">http://ju.outofmemory.cn/entry/28653</a></p>

<p>好吧, 我决定败个 type-s 无刻的, 到时候就会是这样的, 是不是很装X?
<img src="http://lixxu.qiniudn.com/hhkb_pro2_types.png"></p>

<p>随之配合的是, 以后要多用 Vim 了, 或许再学习下 <code>神的编辑器: EMACS</code>?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sublime3 用户设置备份]]></title>
    <link href="http://lixxu.me/blog/2014/05/09/sublime-user-profile-backup/"/>
    <updated>2014-05-09T08:54:27+08:00</updated>
    <id>http://lixxu.me/blog/2014/05/09/sublime-user-profile-backup</id>
    <content type="html"><![CDATA[<p>安装的插件:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. Alignment
</span><span class='line'>2. Autoprefixer
</span><span class='line'>3. PySide
</span><span class='line'>4. PyV8
</span><span class='line'>5. SublimeLinter
</span><span class='line'>6. SublimeTmpl
</span><span class='line'>7. Terminal
</span><span class='line'>8. Markdown Preview
</span><span class='line'>9. Markdown Editing
</span><span class='line'>10. SmartMarkdown
</span><span class='line'>11. Pretty YAML
</span><span class='line'>12. Python Flake8 Lint
</span><span class='line'>13. SideBarEnhancements
</span><span class='line'>14. SublimeCodeIntel
</span><span class='line'>15. Git Config
</span><span class='line'>16. GitStatus
</span><span class='line'>17. Gitignore
</span><span class='line'>18. Go to definition
</span><span class='line'>19. GoToLastEdit
</span><span class='line'>20. SublimeGit</span></code></pre></td></tr></table></div></figure>


<p>Sublime3062 Windows 用户设置备忘:</p>

<!--more-->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;auto_complete_triggers&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="p">[</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;characters&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;selector&quot;</span><span class="p">:</span> <span class="s2">&quot;text.html&quot;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">],</span>
</span><span class='line'>    <span class="nt">&quot;color_scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;Packages/User/Solarized (Light) (SL).tmTheme&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;default_line_ending&quot;</span><span class="p">:</span> <span class="s2">&quot;unix&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;font_face&quot;</span><span class="p">:</span> <span class="s2">&quot;Source Code Pro&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;highlight_line&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;highlight_modified_tabs&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;ignored_packages&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="p">[</span>
</span><span class='line'>        <span class="s2">&quot;Theme - Nil&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;RestructuredText&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;GoSublime&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;BracketHighlighter&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;Vintage&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;Markdown&quot;</span>
</span><span class='line'>    <span class="p">],</span>
</span><span class='line'>    <span class="nt">&quot;soda_classic_tabs&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;soda_folder_icons&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;fade_fold_buttons&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;tab_size&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;translate_tabs_to_spaces&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;trim_trailing_white_space_on_save&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;update_check&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;word_wrap&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;show_encoding&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;show_line_endings&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;ensure_newline_at_eof_on_save&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;draw_white_space&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;always_show_minimap_viewport&quot;</span><span class="p">:</span> <span class="kc">true</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<!--more-->

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sublime text安装Package Control]]></title>
    <link href="http://lixxu.me/blog/2014/05/08/install-package-control-for-sublime-text/"/>
    <updated>2014-05-08T11:46:45+08:00</updated>
    <id>http://lixxu.me/blog/2014/05/08/install-package-control-for-sublime-text</id>
    <content type="html"><![CDATA[<p><code>Ctrl+`</code> 或菜单里 <code>View</code> -> <code>Show Console</code>, 在文本框中输入:</p>

<h1>Sublime3:</h1>

<p><code>
import urllib.request,os,hashlib; h = &lsquo;7183a2d3e96f11eeadd761d777e62404&rsquo; + &lsquo;e330c659d4bb41d3bdf022e94cab3cd0&rsquo;; pf = &lsquo;Package Control.sublime-package&rsquo;; ipp = sublime.installed_packages_path(); urllib.request.install_opener(urllib.request.build_opener(urllib.request.ProxyHandler())); by = urllib.request.urlopen(&lsquo;<a href="http://sublime.wbond.net/">http://sublime.wbond.net/</a>&rsquo; + pf.replace(&lsquo; &rsquo;, &lsquo;%20&rsquo;)).read(); dh = hashlib.sha256(by).hexdigest(); print(&lsquo;Error validating download (got %s instead of %s), please try manual install&rsquo; % (dh, h)) if dh != h else open(os.path.join(ipp, pf), &lsquo;wb&rsquo;).write(by)
</code></p>

<h1>Sublime2:</h1>

<p><code>
import urllib2,os,hashlib; h = &lsquo;7183a2d3e96f11eeadd761d777e62404&rsquo; + &lsquo;e330c659d4bb41d3bdf022e94cab3cd0&rsquo;; pf = &lsquo;Package Control.sublime-package&rsquo;; ipp = sublime.installed_packages_path(); os.makedirs(ipp) if not os.path.exists(ipp) else None; urllib2.install_opener(urllib2.build_opener(urllib2.ProxyHandler())); by = urllib2.urlopen(&lsquo;<a href="http://sublime.wbond.net/">http://sublime.wbond.net/</a>&rsquo; + pf.replace(&lsquo; &rsquo;, &lsquo;%20&rsquo;)).read(); dh = hashlib.sha256(by).hexdigest(); open(os.path.join(ipp, pf), &lsquo;wb&rsquo;).write(by) if dh == h else None; print(&lsquo;Error validating download (got %s instead of %s), please try manual install&rsquo; % (dh, h) if dh != h else &lsquo;Please restart Sublime Text to finish installation&rsquo;)
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Windows下升级pip]]></title>
    <link href="http://lixxu.me/blog/2014/05/07/update-pip/"/>
    <updated>2014-05-07T09:08:11+08:00</updated>
    <id>http://lixxu.me/blog/2014/05/07/update-pip</id>
    <content type="html"><![CDATA[<p>在Windows下由于pip是个exe的可执行文件, 如果使用<code>pip install -U pip</code>的方式升级pip, 将会失败, 因为无法在执行pip时再覆盖它. 这时就需要使用导入包的方式:
<code>python -m pip install -U pip</code></p>

<p>记录下备忘.</p>

<p>Linux下是没有这个问题的, 暂时没研究是什么原理.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pyconus2014 的视频]]></title>
    <link href="http://lixxu.me/blog/2014/04/16/pyconus2014-videos/"/>
    <updated>2014-04-16T16:16:05+08:00</updated>
    <id>http://lixxu.me/blog/2014/04/16/pyconus2014-videos</id>
    <content type="html"><![CDATA[<p>好久没发帖了, 放上pycon2014的视频, 给不方便穿墙的同学访问.</p>

<p>不知道是公司还是360的问题, 上传到后来就没有速度了, 一开始还有几M的速度的.
<img src="http://lixxu.qiniudn.com/360upload.png"></p>

<p>好吧, 某度的共享违规了, 违规你 妈 啊, 用360的吧:</p>

<p><a href="http://yunpan.cn/QNFwAjKWvsniL">http://yunpan.cn/QNFwAjKWvsniL</a>
访问密码 <code>22e8</code></p>

<p><img src="http://lixxu.qiniudn.com/udiab_kcuf.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[编程语言拟人化]]></title>
    <link href="http://lixxu.me/blog/2014/03/20/human-program-language/"/>
    <updated>2014-03-20T09:25:02+08:00</updated>
    <id>http://lixxu.me/blog/2014/03/20/human-program-language</id>
    <content type="html"><![CDATA[<p>在这里 <a href="http://www.v2ex.com/t/104857">http://www.v2ex.com/t/104857</a> 看到带喜感的东东, 发一下.</p>

<p>来源:</p>

<p><a href="http://next.rikunabi.com/tech/docs/ct_s03600.jsp?p=002412">http://next.rikunabi.com/tech/docs/ct_s03600.jsp?p=002412</a>
<a href="http://next.rikunabi.com/tech/docs/ct_s03600.jsp?p=002477">http://next.rikunabi.com/tech/docs/ct_s03600.jsp?p=002477</a></p>

<p>Python</p>

<p><img src="http://lixxu.qiniudn.com/python-human.png"></p>

<!--more-->


<p>Java</p>

<p><img src="http://lixxu.qiniudn.com/java-human.png"></p>

<p>C++</p>

<p><img src="http://lixxu.qiniudn.com/cpp-human.png"></p>

<p>Ruby</p>

<p><img src="http://lixxu.qiniudn.com/ruby-human.png"></p>

<p>PHP</p>

<p><img src="http://lixxu.qiniudn.com/php-human.png"></p>

<p>C#</p>

<p><img src="http://lixxu.qiniudn.com/csharp-human.png"></p>

<p>JavaScript</p>

<p><img src="http://lixxu.qiniudn.com/js-human.png"></p>

<p>Perl</p>

<p><img src="http://lixxu.qiniudn.com/perl-human.png"></p>

<p>C</p>

<p><img src="http://lixxu.qiniudn.com/c-human.png"></p>

<p>VisualBasic</p>

<p><img src="http://lixxu.qiniudn.com/vb-human.png"></p>

<p>R</p>

<p><img src="http://lixxu.qiniudn.com/r-human.png"></p>

<p>Scala</p>

<p><img src="http://lixxu.qiniudn.com/scala-human.png"></p>

<p>Shell</p>

<p><img src="http://lixxu.qiniudn.com/shell-human.png"></p>

<p>ActionScript</p>

<p><img src="http://lixxu.qiniudn.com/actionscript-human.png"></p>

<!--more-->

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MongoDB是否适合在传统公司使用]]></title>
    <link href="http://lixxu.me/blog/2014/02/27/mongodb-is-ready-for-enterprise/"/>
    <updated>2014-02-27T10:52:35+08:00</updated>
    <id>http://lixxu.me/blog/2014/02/27/mongodb-is-ready-for-enterprise</id>
    <content type="html"><![CDATA[<p>注: 这里的传统公司指的是程序, 系统等只是在内部使用,
没有对外提供软件服务的公司, 比如工厂等, 下面就以工厂代替.
工厂里的服务器不会太多, 可能只有一台, 还要提供多种服务.</p>

<p>从几年前知道 <code>MongoDB</code> 开始, 我也在公司内部的许多 web 项目上用上了它.
下面以我当前的情况简单说明一下:</p>

<p>需求: <code>保存设备的测试数据, 维修数据以提供统计分析</code></p>

<p>工厂里数据逻辑不是太复杂, 但是单数据有时候不小, 总量也大.
比如: 某客户的每个产品的测试数据有几K, 几十K, 或上百K, 每月有几万, 几十万或上百万的数据, 当然也有更多的, 取决于产量的多少. 有的产品没有一次测试通过, 需要测试第二次或更多次. 没有测试通过的产品会送到维修区进行维修, 维修的记录也要保存下来, 等等.</p>

<p>这里的图片是一个用于管理维修的 <code>flask</code> 项目的数据.
<img src="http://lixxu.qiniudn.com/data_size.png"></p>

<!--more-->


<p>可以看到, 此服务器的内存为 <code>4G</code>, 数据为 <code>1.23G</code>, 索引为 <code>1.56G</code>, 可用的内存还有 <code>1.55G</code>.
这个项目从去年3月底开始试运行, 到现在差不多有一年的数据量 (430W).<br />
可以预见的是在接下来差不多一年左右, 服务器的内存就要被吃光了, 而且这个吃光是实实在在的吃光, 因为 <code>MongoDB</code> 会把 <code>索引</code> 全部放进内存中, 如果内存容不下 <code>索引 + 工作集 (working set)</code>, 会导致性能急剧下降, 甚至达到不可用的程度.</p>

<p>解决方法无非有这几个:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. 做 Shard, 把数据分到多台服务器上
</span><span class='line'>2. 增加内存
</span><span class='line'>3. 优化索引, 只保留确实需要的
</span><span class='line'>4. 用 SSD 代替 HDD</span></code></pre></td></tr></table></div></figure>


<p>而对我所在工厂有效的只有2 和 3, 可是我在用一台PC作服务器, 我会说吗?
有时候工厂就是这种情况, 由于不是IT部门, 所以基本上没有正规的服务器使用, 大多时候都是使用普通PC作为服务器.
就是可以加内存, 也不能无限地加, 随着时间的推移, 数据会越来越多, 迟早有吃尽内存的那天.</p>

<p>在设计数据库的结构时, 有几点没有考虑到:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. 没有预见到数据有这么大
</span><span class='line'>2. 数据量大的 collection 的字段没有使用尽量短的命名</span></code></pre></td></tr></table></div></figure>


<p>当然对数据量不大的项目来说, <code>MongoDB</code> 还是一个不错的选择:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. 无需定义表结构, 随时增加/删除字段, 这也是我在开始选择它的原因. 没有在工厂里需求三天一变的体验过的人是不知道这个是多么重要的, 个人猜测互联网公司选择 `MongoDB` 也是看中它的快速开发
</span><span class='line'>2. 速度够快, 可以支持列表, 字典等复杂数据类型, 可以让逻辑更简单</span></code></pre></td></tr></table></div></figure>


<p>乱七八糟地说了这么多, 我的结论是:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>如果你没有可以自由使用的服务器的话, 并且数据量较大, 那就不要使用它了, 老老实实地使用关系数据库吧.
</span><span class='line'>我也会在接下来的时间把数据库换成 PostgreSQL.</span></code></pre></td></tr></table></div></figure>


<p>以后的关注点也将集中在: <code>SQLAlchemy</code>, <code>PostgreSQL</code>.
对了, 我的工作环境基于: <code>Python</code>, <code>flask</code></p>

<!--more-->

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reload Flask With Gevent]]></title>
    <link href="http://lixxu.me/blog/2014/02/24/reload-flask-with-gevent/"/>
    <updated>2014-02-24T13:06:22+08:00</updated>
    <id>http://lixxu.me/blog/2014/02/24/reload-flask-with-gevent</id>
    <content type="html"><![CDATA[<p>越来越感觉 Windows 下 <code>flask</code> 自带的 debug server 慢了, 于是就开始寻找替换工具,
先是看了 <code>gunicorn</code>, 但是在 Windows 下有问题. 再接着试了 <code>gevent</code>, 可以跑起来,
但是有个问题, 丰富的 debug 信息看不到了, 只提示 <code>internal server error</code>.
这显然不行, 放狗一搜, 下面就是结果:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c">#-*- coding: utf-8 -*-</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">werkzeug.serving</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">werkzeug.debug</span> <span class="kn">import</span> <span class="n">DebuggedApplication</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">gevent.wsgi</span> <span class="kn">import</span> <span class="n">WSGIServer</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">myapp</span> <span class="kn">import</span> <span class="n">app</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@werkzeug.serving.run_with_reloader</span>
</span><span class='line'><span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class='line'>    <span class="n">app</span> <span class="o">=</span> <span class="n">DebuggedApplication</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">evalex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ws</span> <span class="o">=</span> <span class="n">WSGIServer</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">),</span> <span class="n">app</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ws</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">run</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[新年展望]]></title>
    <link href="http://lixxu.me/blog/2014/02/06/new-year-holiday-back/"/>
    <updated>2014-02-06T09:32:37+08:00</updated>
    <id>http://lixxu.me/blog/2014/02/06/new-year-holiday-back</id>
    <content type="html"><![CDATA[<p>今天是新年节后的第一天上班, 下着雨, 人不多, 多数没回.</p>

<p>记一下今年打算做的事情:</p>

<ol>
<li>使用 <code>PySide</code> 作为图形开发平台, 过去的一年还没做过任何图形工具, 今年要学习一下. 以前用的 <code>wxPython</code> 不打算再用了, 虽然很强大</li>
<li>使用 <code>PySide</code> 做一个全厂通用的 log 文件传送工具, 通过 <code>plugin</code> 处理不同项目和不同格式的 log</li>
<li>做一个小东西或学习一个平台监控一下在管的几台服务器</li>
<li>改善手里的几个 flask 系统</li>
<li>学习/使用 <code>Semantic UI</code> 作为主力 CSS 框架</li>
</ol>


<p>以上.</p>
]]></content>
  </entry>
  
</feed>
